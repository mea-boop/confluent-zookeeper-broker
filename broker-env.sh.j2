#!/bin/bash
# ==============================================================================
# Kafka Broker Environment Configuration
# Generated by Ansible for {{ ansible_fqdn }}
# Mirrors: roles/zookeeper/templates/zookeeper-env.sh.j2 pattern
# ==============================================================================

# JVM Heap
export KAFKA_HEAP_OPTS="{{ broker_heap_opts }}"

# JVM Performance
export KAFKA_JVM_PERFORMANCE_OPTS="{{ broker_jvm_performance_opts }}"

# JMX - internal monitoring port
export KAFKA_JMX_OPTS="-Dcom.sun.management.jmxremote=true \
-Dcom.sun.management.jmxremote.authenticate=false \
-Dcom.sun.management.jmxremote.ssl=false \
-Dcom.sun.management.jmxremote.port={{ kafka_jmx_port }} \
-Dcom.sun.management.jmxremote.rmi.port={{ kafka_jmx_port }} \
-Djava.rmi.server.hostname={{ ansible_fqdn }}"

# Prometheus JMX Exporter - attaches at broker startup on port {{ prometheus_jmx_exporter_port }}
{% if prometheus_jmx_exporter_enabled %}
export KAFKA_OPTS="{{ java_agent_string }}"
{% endif %}

# Log Directory
export LOG_DIR="{{ broker_log_dir }}"

# Log4j
export KAFKA_LOG4J_OPTS="-Dlog4j.configuration=file:{{ broker_config_dir }}/log4j.properties"
